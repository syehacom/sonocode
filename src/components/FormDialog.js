import React, { useState, useEffect, forwardRef } from "react";
import Button from "@material-ui/core/Button";
import TextField from "@material-ui/core/TextField";
import { makeStyles } from "@material-ui/core";
import Dialog from "@material-ui/core/Dialog";
import DialogActions from "@material-ui/core/DialogActions";
import DialogContent from "@material-ui/core/DialogContent";
import Fade from "@material-ui/core/Fade";
import Codialog from "./Codialog";
import Redialog from "./Redialog";
import MediaCard from "./MediaCard";
import firebase from "../utils/Firebase";
import { useForm } from "react-hook-form";
import ToggleButton from "@material-ui/lab/ToggleButton";
import ToggleButtonGroup from "@material-ui/lab/ToggleButtonGroup";
import ReactPlayer from "react-player";
import Fab from "@material-ui/core/Fab";
import { SocialIcon } from "react-social-icons";
import * as FadeIn from "../components/FadeIn";
// import DialogContentText from "@material-ui/core/DialogContentText";
// import DialogTitle from "@material-ui/core/DialogTitle";

const database = firebase.database();

const FormDialog = ({ isOpen, doClose, setValue }) => {
    const [open, setOpen] = useState(false);
    const [commDlg, setCommDlg] = useState(false);
    const [enter, setEnter] = useState(false);
    const [title, setTitle] = useState("");
    const [valid, setValid] = useState("");
    const [alignment, setAlignment] = useState("left");
    const [dialog, setDialog] = useState("");
    const [random, setRandom] = useState(false);
    const [choice, setChoice] = useState(" „Çí‰ΩúÊàê„Åó„Åæ„Åô„Åã");
    const [openmov, setOpenmov] = useState(false);

    useEffect(() => {
        setOpen(isOpen);
    }, [isOpen]);

    const makeRandom = () => {
        const S =
            "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        const N = 10;
        const rand = Array.from(Array(N))
            .map(() => S[Math.floor(Math.random() * S.length)])
            .join("");
        setValid(rand);
        setRandom(true);
        handleDo();
    };

    const handleDo = () => {
        setCommDlg(true);
        setEnter(false);
    };

    const handleCancel = () => {
        setOpen(false);
        doClose();
    };

    const execute = () => {
        if (alignment === "left") {
            firebase
                .database()
                .ref("data/" + valid)
                .once("value", (snapshot) => {
                    if (snapshot.exists()) {
                        setEnter(true);
                        setDialog("„Åô„Åß„Å´‰Ωø„Çè„Çå„Å¶„ÅÑ„Åæ„Åô");
                    } else {
                        setTitle(valid);
                        setEnter(true);
                        database.ref("data/" + valid).set({
                            title: valid,
                            html: "",
                            css: "",
                            js: "",
                            timestamp: firebase.database.ServerValue.TIMESTAMP,
                        });
                        setCommDlg(false);
                        handleCancel();
                    }
                });
        } else {
            firebase
                .database()
                .ref("data/" + valid)
                .once("value", (snapshot) => {
                    if (snapshot.exists()) {
                        setTitle(valid);
                        setCommDlg(false);
                        handleCancel();
                    } else {
                        setEnter(true);
                        setDialog("„Éö„Éº„Ç∏„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");
                    }
                });
        }
    };

    const { register, handleSubmit, errors } = useForm();

    const onSubmit = (data) => {
        // console.log(data); // ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„Çø
    };

    const comment = title;

    const handleAlignment = (event, newAlignment) => {
        if (newAlignment !== null) {
            setAlignment(newAlignment);
            if (newAlignment === "left") {
                setChoice(" „Çí‰ΩúÊàê„Åó„Åæ„Åô„Åã");
            } else {
                setChoice(" „ÇíÂà©Áî®„Åó„Åæ„Åô„Åã");
            }
        }
    };

    const handleOpen = () => {
        setOpenmov(true);
    };

    const handleClose = () => {
        setOpenmov(false);
    };

    const useStyles = makeStyles((theme) => ({
        root: {
            fontSize: "18px",
        },
        buttonColor: {
            "&.Mui-selected": {
                backgroundColor: "#3f51b5",
                color: "#ffffff",
                fontSize: "18px",
            },
        },
        extendedIcon: {
            marginRight: theme.spacing(1),
            backgroundColor: "#3f51b5",
            color: "#ffffff",
            fontSize: "22px",
        },
    }));
    const classes = useStyles();

    return (
        <div className="open">
            <p>{setValue(comment)}</p>
            <form onChange={handleSubmit(onSubmit)}>
                <Dialog
                    fullScreen
                    open={open}
                    // onClose={handleCancel}
                    TransitionComponent={Transition}
                    transitionDuration="0"
                    keepMounted
                    aria-labelledby="form-dialog-title">
                    <div className="all">
                        <header>
                            <div className="two"></div>
                            <div className="carousel-caption">
                                <div className="content">
                                    SONO
                                    <br></br>
                                    <span className="contentchild1">
                                        CODE{" "}
                                        <span className="contentchild2">
                                            &lt;/&gt;
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </header>
                        <main>
                            <FadeIn.Up>
                                <div className="flex-container">
                                    <div className="flex-item">
                                        <h1>„Åù„ÅÆ„Ç≥„Éº„Éâ„ÇíÁ∞°Âçò&amp;‰æøÂà©„Å´ÂÖ±Êúâ</h1>
                                        <p>
                                            „Åæ„Åö„ÅØ„ÄÅ„Éö„Éº„Ç∏„Çí‰ΩúÊàê„Åó„Å¶„Åø„Çà„ÅÜ„ÄÇ
                                            {/* <span role="img" aria-label="emoji">
                                            üòÉ
                                        </span> */}
                                            „Éö„Éº„Ç∏Âêç„ÇíÂÖ±Êúâ„Åó„Å¶Èü≥Â£∞„ÉÅ„É£„ÉÉ„Éà„ÇÑ„Éó„É¨„Éì„É•„Éº„Çí‰Ωø„ÅÑ„Ç¶„Çß„Éñ„Éá„Ç∂„Ç§„É≥„ÇíÊïô„Åà„Åü„Çä„ÄÅ‰∏ÄÁ∑í„Å´ËÄÉ„Åà„Åü„Çä„Åó„Çà„ÅÜ„ÄÇ
                                        </p>
                                        <div className="movie">
                                            <Fab
                                                variant="extended"
                                                onClick={handleOpen}
                                                className={
                                                    classes.extendedIcon
                                                }>
                                                ÂãïÁîª„ÇíË¶ã„Å¶„Åø„Çà„ÅÜ
                                            </Fab>
                                            <Dialog
                                                onClose={handleClose}
                                                aria-labelledby="simple-dialog-title"
                                                open={openmov}>
                                                <ReactPlayer
                                                    url="https://youtu.be/Uu9F5Pug6jI"
                                                    height="500px"
                                                    width="600px"
                                                    controls
                                                    playing
                                                    muted
                                                />
                                            </Dialog>
                                        </div>
                                    </div>
                                    <div className="three flex-item"></div>
                                </div>
                            </FadeIn.Up>
                            <FadeIn.Up>
                                <div className="flex-container">
                                    <div className="four flex-item"></div>
                                    <div className="flex-item">
                                        <h1>„Åï„ÅÇ„ÄÅ„ÅØ„Åò„ÇÅ„Å¶„Åø„Çà„ÅÜÔºÅ</h1>
                                        <p>PCÁâà GoogleChrome „Åß„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                                        <div className="toggle">
                                            <ToggleButtonGroup
                                                // orientation="vertical"
                                                value={alignment}
                                                exclusive
                                                onChange={handleAlignment}
                                                aria-label="text alignment">
                                                <ToggleButton
                                                    classes={{
                                                        selected:
                                                            classes.buttonColor,
                                                        root: classes.root,
                                                    }}
                                                    value="left"
                                                    aria-label="left aligned">
                                                    ‰ΩúÊàê„Åô„Çã
                                                </ToggleButton>
                                                <ToggleButton
                                                    classes={{
                                                        selected:
                                                            classes.buttonColor,
                                                        root: classes.root,
                                                    }}
                                                    value="right"
                                                    aria-label="right aligned">
                                                    Âà©Áî®„Åô„Çã
                                                </ToggleButton>
                                            </ToggleButtonGroup>
                                            <DialogContent>
                                                {/* <DialogContentText></DialogContentText> */}
                                                <TextField
                                                    inputProps={{
                                                        style: { fontSize: 18 },
                                                    }} // font size of input text
                                                    InputLabelProps={{
                                                        style: { fontSize: 18 },
                                                    }} // font size of input label
                                                    defaultValue=""
                                                    autoFocus
                                                    name="body"
                                                    margin="normal"
                                                    id="name"
                                                    label="„Éö„Éº„Ç∏Âêç"
                                                    type="text"
                                                    className={
                                                        classes.textField
                                                    }
                                                    fullWidth
                                                    onChange={(e) =>
                                                        setValid(e.target.value)
                                                    }
                                                    inputRef={register({
                                                        required: true,
                                                        minLength: 10,
                                                        // pattern: /^([a-zA-Z0-9]{10,})$/,
                                                    })}
                                                    error={Boolean(errors.body)}
                                                    helperText={
                                                        errors.body &&
                                                        "10ÊñáÂ≠ó‰ª•‰∏ä„Å´„Åó„Å¶‰∏ã„Åï„ÅÑ„ÄÇ"
                                                    }
                                                />
                                            </DialogContent>
                                            <DialogActions>
                                                {valid && (
                                                    <Button
                                                        disabled={Boolean(
                                                            errors.body
                                                        )}
                                                        type="submit"
                                                        onClick={handleDo}
                                                        color="primary">
                                                        OK
                                                    </Button>
                                                )}
                                                {!valid && (
                                                    <Button
                                                        disabled={Boolean(
                                                            alignment ===
                                                                "right"
                                                        )}
                                                        type="submit"
                                                        onClick={makeRandom}
                                                        color="primary">
                                                        „É©„É≥„ÉÄ„É†
                                                    </Button>
                                                )}
                                            </DialogActions>
                                        </div>
                                    </div>
                                </div>
                            </FadeIn.Up>
                            <FadeIn.Up>
                                <div className="user">
                                    <h1>„Éã„Éº„Ç∫„Å´Âêà„Å£„Åü‰Ωø„ÅÑÊñπ„Çí„Åó„Çà„ÅÜ</h1>
                                </div>
                                <div className="flex-card">
                                    <div className="flex-item">
                                        <MediaCard
                                            shop1={
                                                "https://thumbs.dreamstime.com/z/programing-language-design-illustration-eps-graphic-65093426.jpg"
                                            }
                                            shop2={"„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞ÊïôÂÆ§"}
                                            shop3={
                                                "„É™„É¢„Éº„Éà„Åß„ÅÆÈÅãÂñ∂„Å´ÈÅ©„Åó„Å¶„ÅÑ„Åæ„Åô"
                                            }
                                        />
                                    </div>
                                    <div className="flex-item">
                                        <MediaCard
                                            shop1={
                                                "https://thumbs.dreamstime.com/z/young-programmers-coding-new-project-big-tablet-ps-phone-flat-modern-illustration-programmer-laptop-using-programmimg-137771074.jpg"
                                            }
                                            shop2={"Èöú„Åå„ÅÑ„Åå„ÅÇ„ÇãÊñπ„Å∏„ÅÆÊîØÊè¥"}
                                            shop3={
                                                "‰∫ãÊ•≠ÊâÄ„Åß„ÅÆ‰ΩúÊ•≠„ÇÑË®ìÁ∑¥„Å´Ê¥ªÁî®„Åß„Åç„Åæ„Åô"
                                            }
                                        />
                                    </div>
                                    <div className="flex-item">
                                        <MediaCard
                                            shop1={
                                                "https://image.freepik.com/free-vector/programmer-concept-illustration_114360-2284.jpg"
                                            }
                                            shop2={"„ÇØ„É©„Ç§„Ç¢„É≥„Éà„Å®„ÅÆÊâìÂêà„Åõ"}
                                            shop3={
                                                "„Éá„Ç∂„Ç§„É≥„ÅÆÁ¢∫Ë™ç„ÇÑÂÖ±Êúâ„Å´ÂΩπ„Å´Á´ã„Å°„Åæ„Åô"
                                            }
                                        />
                                    </div>
                                </div>
                            </FadeIn.Up>
                        </main>
                        <footer className="container">
                            <div style={{ marginTop: 1 + "em" }}></div>
                            <div>
                                <p className="footer">
                                    ÂΩì„Çµ„Ç§„Éà„ÅÆÂà©Áî®„Å´„Å§„ÅÑ„Å¶„ÅØ‰∏ãË®òÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„ÄÅÊâøË´æ„Åó„Åü‰∏ä„Åß„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ
                                    Ê¨°„Å´Êé≤„Åí„Çã„Éö„Éº„Ç∏„ÅÆ‰ΩúÊàê„ÅØÁ¶ÅÊ≠¢„Å®„Åó„Åæ„Åô„ÄÇÊäïÁ®øÂÜÖÂÆπ„ÅåÁ¶ÅÊ≠¢‰∫ãÈ†Ö„Å´Ë©≤ÂΩì„Åô„Çã„Å®Âà§Êñ≠„Åó„ÅüÂ†¥
                                    Âêà„ÅØ„ÄÅ‰ΩúÊàêËÄÖ„Å´‰∫ãÂâç„Å´‰Ωï„ÇâÈÄöÁü•„Åô„Çã„Åì„Å®„Å™„Åè„ÄÅÊäïÁ®ø„ÅÆÂâäÈô§„Åù„ÅÆ‰ªñÂøÖË¶Å„Å™Êé™ÁΩÆ„ÇíÂèñ„Çã„Åì„Å®„Å®„Åó„Åæ„Åô„ÄÇ
                                    „ÄêÁ¶ÅÊ≠¢‰∫ãÈ†Ö„Äë
                                    „ÉªÊú¨‰∫∫„ÅÆÂêåÊÑè„ÅÆ„Å™„ÅÑÁ¨¨‰∏âËÄÖ„ÅÆÂÄã‰∫∫ÊÉÖÂ†±„Åß„ÅÇ„Å£„Å¶„ÄÅ„Éó„É©„Ç§„Éê„Ç∑„Éº„Å™„Å©ÂÄã
                                    ‰∫∫„ÅÆÊ®©Âà©Âà©Áõä„Çí‰æµÂÆ≥„Åô„Çã„ÇÇ„ÅÆ
                                    „ÉªÊ≥ï‰ª§Á≠â„Å´ÈÅïÂèç„Åó„ÄÅÂèà„ÅØÈÅïÂèç„Åô„ÇãÊÅê„Çå„ÅÆ„ÅÇ„Çã„ÇÇ„ÅÆ
                                    „Éª ÂÖ¨Â∫èËâØ‰øó„Å´Âèç„Åô„Çã„ÇÇ„ÅÆ„Éª
                                    ‰∫∫Ê®©‰æµÂÆ≥„Å®„Å™„Çã„ÇÇ„ÅÆ„Éª
                                    ÁâπÂÆö„ÅÆÂÄã‰∫∫„ÄÅ‰ºÅÊ•≠„ÄÅÂõ£‰ΩìÁ≠â„ÇíË™πË¨ó‰∏≠ÂÇ∑„Åô„Çã„ÇÇ„ÅÆ
                                    „Éª ËôöÂÅΩ„ÇÑ‰∫ãÂÆüË™§Ë™ç„ÅÆÂÜÖÂÆπ„ÇíÂê´„ÇÄ„ÇÇ„ÅÆ „Éª
                                    „Çè„ÅÑ„Åõ„Å§„Å™Ë°®ÁèæÁ≠â‰∏çÈÅ©Âàá„Å™ÂÜÖÂÆπ„ÇíÂê´„ÇÄ„ÇÇ„ÅÆ „Éª
                                    „Åù„ÅÆ‰ªñ„ÄÅÂΩì„Çµ„Ç§„Éà„Åå‰∏çÈÅ©Âàá„Å®Âà§Êñ≠„Åó„Åü„ÇÇ„ÅÆ„ÄÇ
                                    ‰∏ÄÂÆöÊúüÈñìÂæå„Å´„Éö„Éº„Ç∏„ÅØÂÆåÂÖ®„Å´Ê∂àÂéª„Åï„Çå„Åæ„Åô„Åå„ÄÅ
                                    ‰ΩúÊàê„Åó„Åü„Éö„Éº„Ç∏„ÅåÁ†¥Â£ä„ÄÅÊ∂àÂ§±„Åæ„Åü„ÅØÂ§âÊõ¥„Åï„Çå„ÅüÂ†¥Âêà„Åß
                                    „ÅÇ„Å£„Å¶„ÇÇÂΩì„Çµ„Ç§„Éà„ÅØ‰∏ÄÂàáË≤¨‰ªª„ÇíË≤†„ÅÑ„Åæ„Åõ„Çì„ÄÇ
                                </p>
                                <div className="credit">
                                    SONOCODE„ÄÄ„ÄÄ¬©2021 Syehacom„ÄÄ
                                    <SocialIcon
                                        style={{ height: 35, width: 35 }}
                                        url="https://twitter.com/sonocode_syeha"
                                    />
                                </div>
                                <br></br>
                                <br></br>
                            </div>
                        </footer>
                    </div>
                </Dialog>
            </form>
            {enter ? (
                <Redialog
                    msg={dialog}
                    isOpen={commDlg}
                    doNo={() => {
                        setCommDlg(false);
                    }}
                />
            ) : (
                <Codialog
                    msg={valid + choice}
                    isOpen={commDlg}
                    doYes={execute}
                    doNo={() => {
                        setCommDlg(false);
                        if (random === true) {
                            setValid("");
                            setRandom(false);
                        }
                    }}
                />
            )}
        </div>
    );
};

const Transition = forwardRef(function Transition(props, ref) {
    return <Fade ref={ref} {...props} />;
});

export default FormDialog;
